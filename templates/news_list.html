<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新闻列表</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="static/css/bootstrap.css">

    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/js/bootstrap.js"></script>
    <script type="text/javascript" src="static/js/echarts.min.js"></script>
    <script type="text/javascript" src="static/js/word-cloud.js"></script>
    <script type="text/javascript" src="static/js/tu.js"></script>
</head>
<body>
<div class="container-fluid">


    <div class="row-fluid">
        <div class="span12">
                <div class="form-group">
                    <input type="text" id="search" style="width:800px;display:inline;" class="form-control" placeholder="输入关键词">
                        <button onclick="change_page(1)" class="btn btn-default">Submit</button>
                </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span2">
        </div>
        <div class="span10">
            <table class="table table-hover" id="table">


<thead>
                <tr>
                    <th style="width:100px;">标题</th>
                    <th>内容</th>
                    <th>评论内容</th>
                    <th>评论条数</th>
                    <th>新闻类别</th>
                    <th>操作</th>
                </tr>
</thead>
                <tbody>

                </tbody>


            </table>
        </div>
    </div>
    <div class="row-fluid" id="pagecheck">
        <ul class="pagination">
            <li><a href="#">&laquo;</a></li>
            <li class="active"><a href="#">1</a></li>
            <li class="disabled"><a href="#">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li><a href="#">5</a></li>
            <li><a href="#">&raquo;</a></li>
        </ul>
    </div>
    </ul>
</div>
</body>


<script>
    function add_list(news_list) {
        //
        var artTable = document.getElementById("table");
        artTable.innerHTML="<thead>\n" +
            "                <tr>\n" +
            "                    <th style=\"width:200px;\">标题</th>\n" +
            "                    <th  style=\"width:400px;\">内容</th>\n" +
            "                    <th>评论内容</th>\n" +
            "                    <th>评论条数</th>\n" +
            "                    <th>新闻类别</th>\n" +
            "                    <th>操作</th>\n" +
            "                </tr>\n" +
            "</thead>"
        // artBody.parentNode.outerHTML = artBody.parentNode.outerHTML.replace(artBody.innerHTML, "");
        for (i in news_list) {
            var x = document.getElementById('table').insertRow(1)
                        var str = news_list[i]['title']+"<a href='http://127.0.0.1:5000/testget?name=" + news_list[i]['title'] + "'>查看详情</a>"

            x.insertCell(0).innerHTML = news_list[i]['title']
            x.insertCell(1).innerHTML = news_list[i]['article']
            comments_text=''
            for (index in news_list[i]['comments']){
                comments_text=comments_text+'<p>'+news_list[i]['comments'][index]
            }

            // x.insertCell(2).innerHTML = news_list[i]['comments']
            x.insertCell(2).innerHTML=comments_text
            x.insertCell(3).innerHTML = news_list[i]['counts']
            x.insertCell(4).innerHTML = news_list[i]['category']
            var str ="<a href='http://127.0.0.1:5000/testget?name=" + news_list[i]['title'] + "'>查看详情</a>"
            x.insertCell(5).innerHTML = str
        }

        // var artTable = document.getElementById("table");
        // alert(artTable.row)
        // artTable.innerHTML='';

        // alert(news_list[1]['url']);
    }
</script>

<script type="text/javascript">
    function list(page,keyword) {
        var $page;
        var $number = 10;
        if (page == '') {
            $page = 1;
        } else {
            $page = page;
        }
        var  $keyword=keyword

        jQuery.ajax({
            url: '/list',
            type: 'post',
            async: true,
            data: {page: $page, number: $number,keyword: $keyword},
            dataType: 'json',
            success: function (result) {
                var info_news = result;
                add_list(info_news);
            },
            error: function (result) {
                console.log('异常');
            }
        })
    }
</script>
<script>
    //
    change_page(1)
    function change_page(page) {
        var $keyword=document.getElementById('search').value

        list(page,$keyword);
        var x = document.getElementById('pagecheck');
        var str = '<ul class="pagination">';
        if (page > 1) {
            str = str + '<li><a onclick="change_page(' + (page - 1) + ')">&laquo;</a></li>'
        }
        for (i = 0; i < 5; i++) {
            {
                if (i==0){str = str + '<li  class="active"><a onclick=" change_page(' + (i + page) + ')">' + (i + page) + '</a></li>'}
                else{
                str = str + '<li><a onclick=" change_page(' + (i + page) + ')">' + (i + page) + '</a></li>'}
            }
        }
        str = str + '<li><a onclick=" change_page(' + (5 + page) + ')">&raquo;</a></li>\n' +
            '        </ul>'
        x.innerHTML = str;
    }

</script>
</html>